# X アカウント位置情報タグ付けツール

[简体中文](../README.md) | [English](README.en.md) | [日本語](README.ja.md)

## 目次

- [概要](#概要)
- [インストールと使用方法](#インストールと使用方法)
- [技術実装](#技術実装)
- [プライバシーとセキュリティ](#プライバシーとセキュリティ)

## 概要

X では「このアカウントについて」セクションでアカウントの位置情報と App Store 地域情報を表示していますが、このデータはタイムラインには表示されません。このスクリプトは各ツイートのタイムスタンプの横にインタラクティブなボタンを追加し、オンデマンドで位置情報を照会できるようにします。

**主な機能：**
- **オンデマンドクエリ**：クリックで照会、自動一括リクエストなし、レート制限を回避
- **VPN 検出**：色分けされた結果（グレーは検証済み位置、赤は VPN 使用の可能性）
- **スマートキャッシング**：以前に照会したアカウントは追加の API 呼び出しなしで自動的にラベル付け

スクリプトは X の内部 GraphQL API を使用して位置データを取得し、位置精度に基づいて適切な視覚的インジケーターを表示します。

## インストールと使用方法

1. [Tampermonkey](https://www.tampermonkey.net/) または [Violentmonkey](https://violentmonkey.github.io/) をインストール
2. （推奨）[Greasy Fork](https://greasyfork.org/zh-CN/scripts/556852-x-account-location-tagger) から直接インストール、または手動で新しいユーザースクリプトを作成
3. 手動インストールの場合は `X.js` の内容をコピー
4. スクリプトを保存して有効化
5. X にアクセスして位置ボタンをクリック開始

任意の X タイムラインに移動すると、ツイートのタイムスタンプの横に地図ピンアイコンが表示されます：

- ピンをクリックして位置を照会
- ボタンは取得中にローディング状態を表示
- 結果は次のように表示：`[国/地域 / App Store 地域]`
- グレーのテキストは検証済みの位置を示す
- 赤いテキストは VPN 使用の可能性を示す

## 技術実装

スクリプトは X の内部 GraphQL API エンドポイント `AboutAccountQuery` を使用します。これは「このアカウントについて」機能を支える同じエンドポイントです。位置ボタンをクリックすると：

1. ツイートのタイムスタンプリンクからユーザー名を抽出
2. セッション認証情報を使用して GraphQL クエリを送信
3. `account_based_in` と `source` フィールドのレスポンスを解析
4. `location_accurate` をチェックして VPN の可能性を判定
5. 適切な色分けで結果を表示

すべてのリクエストには、アクティブな X セッションからの適切な CSRF トークンと認証ヘッダーが含まれます。

スクリプトは次の形式のレスポンスを解析します：

```json
{
  "data": {
    "user_result_by_screen_name": {
      "result": {
        "about_profile": {
          "account_based_in": "Japan",
          "location_accurate": true,
          "source": "Japan App Store"
        }
      }
    }
  }
}
```

主要フィールド：
- `account_based_in`：地理的位置
- `source`：App Store 地域またはクライアントアプリ
- `location_accurate`：VPN 検出フラグ

スクリプトは最小限の設定が必要です。すべての設定はハードコードされています：

```javascript
const ABOUT_ENDPOINT = 'https://x.com/i/api/graphql/zs_jFPFT78rBpXv9Z3U2YQ/AboutAccountQuery';
const AUTH_BEARER = 'Bearer [公式 Web クライアントトークン]';
const DEBUG = true;
```

デバッグモードはすべてのリクエストとレスポンスをコンソールに記録します。無効にするには `false` に設定してください。

オンデマンド設計により、レート制限の問題が自然に回避されます。クリック時にのみリクエストを送信し、キャッシュが重複クエリを防ぎます。429 エラーが発生した場合は、数分待ってから続行してください。

## プライバシーとセキュリティ

このスクリプトは：
- 公開 X API エンドポイントのみを使用
- UI で既に利用可能な情報のみを表示
- サードパーティサーバーにデータを送信しない
- すべてをブラウザでローカルに処理
- アクティブな X セッションが必要（ログイン必須）

表示されるデータは、X が既に知っており、アカウント詳細ページで表示している内容です。このスクリプトは単にそれをよりアクセスしやすくします。

## ライセンス

MIT ライセンス - 自由に使用、必要に応じて変更、保証なし。

## 謝辞

X の内部 GraphQL API をリバースエンジニアリングして構築しました。これを可能にしたブラウザ開発者ツールに感謝します。

---

**注意**：このスクリプトは X の内部 API に依存しており、予告なく変更される可能性があります。X が GraphQL スキーマまたはエンドポイント構造を変更した場合、更新が必要になる可能性があります。
